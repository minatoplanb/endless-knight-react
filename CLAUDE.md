# Endless Knight - React Native

> Claude Code å·¥ä½œæ‰‹å†Šã€‚æ¯æ¬¡é–‹å§‹å‰å…ˆè®€é€™ä»½æ–‡ä»¶ã€‚

---

## åŸºæœ¬è¨­å®š

| è¨­å®š | å€¼ |
|------|---|
| èªè¨€ | ç¹é«”ä¸­æ–‡ï¼ˆç¨‹å¼ç¢¼å’Œè¨»è§£ç”¨è‹±æ–‡ï¼‰|
| ç‰ˆæœ¬ | v0.1.0ï¼ˆReact Native é‡å¯«ï¼‰|
| æ¡†æ¶ | React Native + Expo SDK 52 |
| ç‹€æ…‹ç®¡ç† | Zustand |
| å­˜æª” | @react-native-async-storage/async-storage |
| å°èˆª | expo-router |
| å»ºç½® | EAS Build |
| ç›®æ¨™ | Android (Google Play) |

---

## éŠæˆ²æ¦‚å¿µ

é€™æ˜¯ä¸€å€‹ Idle Auto-Battlerã€‚ç©å®¶è§’è‰²è‡ªå‹•å¾€å³èµ°ã€è‡ªå‹•æ‰“æ€ªã€æ”¶é›†é‡‘å¹£å‡ç´šã€‚

**æ²’æœ‰å‹•ç•«ã€‚** æˆ°é¬¥ç”¨éœæ…‹åœ–ç‰‡ + æ•¸å­—è·³å‹• + ç°¡å–®çš„é–ƒçˆ/æ·¡å…¥æ·¡å‡ºè¡¨ç¾ã€‚
æ•´å€‹éŠæˆ²æœ¬è³ªä¸Šæ˜¯ä¸€å€‹ã€Œæœ‰éŠæˆ²é‚è¼¯çš„ Appã€ï¼Œä¸æ˜¯å‚³çµ±æ„ç¾©çš„éŠæˆ²ã€‚

### æ ¸å¿ƒå¾ªç’°
```
è‡ªå‹•ç§»å‹•ï¼ˆé€²åº¦æ¢ï¼‰â†’ é‡åˆ°æ•µäºº â†’ è‡ªå‹•æˆ°é¬¥ï¼ˆæ•¸å­—è·³å‹•ï¼‰â†’ æ•µäººæ­» â†’ æ‰é‡‘å¹£
                                                    â†’ ç©å®¶æ­» â†’ å›ä¸Šä¸€é—œ
é›¢ç·šæ™‚ â†’ è¨ˆç®—é›¢ç·šæ”¶ç›Š â†’ å›ä¾†æ™‚é ˜å–
```

---

## å°ˆæ¡ˆçµæ§‹

```
endless-knight-react/
â”œâ”€â”€ app/                          # Expo Router é é¢
â”‚   â”œâ”€â”€ _layout.tsx               # æ ¹ä½ˆå±€ï¼ˆSafeAreaView + åº•éƒ¨å°èˆªï¼‰
â”‚   â”œâ”€â”€ index.tsx                 # ä¸»ç•«é¢ï¼šæˆ°é¬¥ + å‡ç´š
â”‚   â”œâ”€â”€ equipment.tsx             # è£å‚™/èƒŒåŒ…
â”‚   â””â”€â”€ prestige.tsx              # è½‰ç”Ÿ
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ battle/
â”‚   â”‚   â”‚   â”œâ”€â”€ BattleView.tsx    # æˆ°é¬¥å€åŸŸï¼ˆèƒŒæ™¯ + è§’è‰² + HPæ¢ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ CharacterSprite.tsx # éœæ…‹è§’è‰²åœ–ï¼ˆé–ƒçˆæ•ˆæœï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ HealthBar.tsx     # HP æ¢å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ DamagePopup.tsx   # å‚·å®³é£„å­—
â”‚   â”‚   â”‚   â””â”€â”€ StageProgress.tsx # é—œå¡é€²åº¦æ¢
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”œâ”€â”€ UpgradePanel.tsx  # å‡ç´šæŒ‰éˆ•é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ UpgradeButton.tsx # å–®å€‹å‡ç´šæŒ‰éˆ•
â”‚   â”‚   â”‚   â”œâ”€â”€ StatBar.tsx       # å±¬æ€§é¡¯ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ GoldDisplay.tsx   # é‡‘å¹£ï¼ˆæœ‰å‹•ç•«ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ TopBar.tsx        # é ‚éƒ¨è³‡è¨Šåˆ—
â”‚   â”‚   â”œâ”€â”€ modals/
â”‚   â”‚   â”‚   â”œâ”€â”€ DeathModal.tsx    # æ­»äº¡å½ˆçª—
â”‚   â”‚   â”‚   â”œâ”€â”€ OfflineModal.tsx  # é›¢ç·šçå‹µ
â”‚   â”‚   â”‚   â””â”€â”€ LootModal.tsx     # è£å‚™æ‰è½
â”‚   â”‚   â””â”€â”€ common/
â”‚   â”‚       â”œâ”€â”€ PixelText.tsx     # åƒç´ é¢¨æ–‡å­—ï¼ˆè‡ªè¨‚å­—é«”ï¼‰
â”‚   â”‚       â””â”€â”€ PressableScale.tsx # æœ‰ç¸®æ”¾å›é¥‹çš„æŒ‰éˆ•
â”‚   â”œâ”€â”€ engine/
â”‚   â”‚   â”œâ”€â”€ GameEngine.ts         # ä¸»å¼•æ“ï¼ˆsetInterval 100msï¼‰
â”‚   â”‚   â”œâ”€â”€ CombatSystem.ts       # å‚·å®³è¨ˆç®—
â”‚   â”‚   â”œâ”€â”€ LootSystem.ts         # æ‰è½è¨ˆç®—
â”‚   â”‚   â””â”€â”€ OfflineSystem.ts      # é›¢ç·šæ”¶ç›Š
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”œâ”€â”€ useGameStore.ts       # Zustand ä¸» store
â”‚   â”‚   â””â”€â”€ useSave.ts            # è‡ªå‹•å­˜æª” hook
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ enemies.ts            # æ•µäººå®šç¾©
â”‚   â”‚   â”œâ”€â”€ equipment.ts          # è£å‚™è³‡æ–™
â”‚   â”‚   â””â”€â”€ stages.ts             # é—œå¡è¨­å®š
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ format.ts             # formatNumber, formatTime
â”‚   â”‚   â””â”€â”€ math.ts               # å…±ç”¨è¨ˆç®—
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ game.ts               # éŠæˆ²å¸¸æ•¸ï¼ˆBASE_HP, SCALING ç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ theme.ts              # é¡è‰²ã€å­—é«”ã€é–“è·
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts              # TypeScript å‹åˆ¥
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ player.png            # ç©å®¶éœæ…‹åœ–ï¼ˆæ­£é¢/æˆ°é¬¥å§¿å‹¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ enemies/              # æ•µäººéœæ…‹åœ–
â”‚   â”‚   â””â”€â”€ backgrounds/          # é—œå¡èƒŒæ™¯
â”‚   â”œâ”€â”€ icons/                    # è£å‚™/æŠ€èƒ½åœ–ç¤º
â”‚   â””â”€â”€ fonts/                    # åƒç´ å­—é«”
â”œâ”€â”€ CLAUDE.md                     # é€™å€‹æ–‡ä»¶
â”œâ”€â”€ CHANGELOG.md
â”œâ”€â”€ app.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

---

## æ‰‹æ©Ÿå„ªåŒ–è¦ç¯„

### è¢å¹•é©é…
```typescript
import { Dimensions } from 'react-native';
const { width: SCREEN_W, height: SCREEN_H } = Dimensions.get('window');

// æ‰€æœ‰å°ºå¯¸ç”¨æ¯”ä¾‹ï¼Œä¸è¦ç”¨å›ºå®š px
// åŸºæº–è¨­è¨ˆç¨¿ï¼š375 x 812 (iPhone SE/å°è¢å¹•)
const scale = (size: number) => (SCREEN_W / 375) * size;

// ä½¿ç”¨ç¯„ä¾‹
fontSize: scale(14)
padding: scale(12)
```

### ä½ˆå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TopBarï¼ˆå›ºå®šé«˜åº¦ 50ï¼‰     â”‚  â† SafeAreaView å…§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚   BattleView            â”‚  â† flex: 3ï¼ˆä½” 60%ï¼‰
â”‚   (èƒŒæ™¯ + è§’è‰² + HP)     â”‚
â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   StageProgress         â”‚  â† å›ºå®šé«˜åº¦ 30
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚   UpgradePanel          â”‚  â† flex: 2ï¼ˆä½” 40%ï¼‰
â”‚   (ScrollView)          â”‚     å¯æ²å‹•ï¼
â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BottomNavï¼ˆå›ºå®šé«˜åº¦ 60ï¼‰  â”‚  â† åº•éƒ¨å°èˆª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•ˆèƒ½è¦å‰‡
- **ä¸è¦åœ¨ render ä¸­ new Object** - æ‰€æœ‰ style ç”¨ StyleSheet.create
- **ä¸è¦åœ¨ render ä¸­ bind function** - ç”¨ useCallback
- **åˆ—è¡¨ç”¨ FlatList** - ä¸è¦ç”¨ map + ScrollView
- **åœ–ç‰‡ç”¨å›ºå®šå°ºå¯¸** - ä¸è¦è®“åœ–ç‰‡è‡ªé©æ‡‰
- **é¿å…é‡æ–°æ¸²æŸ“** - ç”¨ React.memo åŒ…è£ä¸å¸¸è®Šçš„å…ƒä»¶
- **éŠæˆ²å¼•æ“ä¸è§¸ç™¼æ•´é é‡æ–°æ¸²æŸ“** - åªæ›´æ–° Zustand ä¸­è®ŠåŒ–çš„ slice

### è§¸æ§è¦å‰‡
- æœ€å°è§¸æ§å€åŸŸï¼š48x48 dp
- æŒ‰éˆ•ä¹‹é–“é–“è·è‡³å°‘ 8dp
- å‡ç´šæŒ‰éˆ•è¦å¤§ï¼Œæ–¹ä¾¿å–®æ‰‹æ“ä½œ
- åº•éƒ¨å°èˆªç”¨å¤§åœ–ç¤º

---

## éŠæˆ²æ•¸å€¼

### æ•µäºº
```typescript
const getEnemyStats = (stage: number) => ({
  hp: Math.floor(30 * Math.pow(1.15, stage - 1)),
  atk: Math.floor(5 * Math.pow(1.08, stage - 1)),
  goldDrop: Math.floor(10 * Math.pow(1.10, stage - 1)),
});
```

### å‡ç´š
```typescript
const getUpgradeCost = (type: string, level: number) =>
  Math.floor(100 * Math.pow(1.5, level));

const UPGRADE_EFFECTS = {
  hp: { perLevel: 15, stat: 'maxHp' },
  atk: { perLevel: 5, stat: 'atk' },
  def: { perLevel: 3, stat: 'def' },
  speed: { perLevel: 0.05, stat: 'attackSpeed' }, // æ”»æ“Šé »ç‡
  crit: { perLevel: 0.005, stat: 'critChance' },
};
```

### é›¢ç·š
```typescript
const MAX_OFFLINE_HOURS = 8;
const OFFLINE_EFFICIENCY = 0.5; // é›¢ç·šæ•ˆç‡ 50%
```

---

## é¡è‰²ä¸»é¡Œ

```typescript
export const COLORS = {
  // èƒŒæ™¯
  bg: '#0f0f23',
  bgLight: '#1a1a3e',
  panel: '#16213e',
  
  // æ–‡å­—
  text: '#ffffff',
  textDim: '#8888aa',
  textGold: '#ffd700',
  
  // è¡€æ¢
  hpFull: '#44ff44',
  hpMid: '#ffff44',
  hpLow: '#ff4444',
  
  // ç¨€æœ‰åº¦
  common: '#ffffff',
  uncommon: '#44ff44',
  rare: '#4488ff',
  epic: '#aa44ff',
  legendary: '#ffaa00',
  
  // æŒ‰éˆ•
  buttonPrimary: '#4466aa',
  buttonDisabled: '#333355',
  buttonSuccess: '#44aa44',
};
```

---

## æˆ°é¬¥è¡¨ç¾ï¼ˆç„¡å‹•ç•«ç‰ˆï¼‰

### æ”»æ“Šè¡¨ç¾
```
ç©å®¶æ”»æ“Šæ•µäººï¼š
1. æ•µäººåœ–ç‰‡é–ƒç´… (opacity 0.5 â†’ 1.0, 100ms)
2. æ•µäºº HP æ¢ç¸®çŸ­ï¼ˆanimated widthï¼‰
3. å‚·å®³æ•¸å­—å¾æ•µäººä½ç½®å¾€ä¸Šé£„ + æ·¡å‡º
4. å¦‚æœæš´æ“Šï¼šæ•¸å­—æ”¾å¤§ + é»ƒè‰²

æ•µäººæ”»æ“Šç©å®¶ï¼š
1. ç©å®¶åœ–ç‰‡é–ƒç´… (åŒä¸Š)
2. ç©å®¶ HP æ¢ç¸®çŸ­
3. å‚·å®³æ•¸å­—ï¼ˆç´…è‰²ï¼‰

æ•µäººæ­»äº¡ï¼š
1. æ•µäººåœ–ç‰‡æ·¡å‡º (opacity 1 â†’ 0, 300ms)
2. é‡‘å¹£ +X é£„å­—ï¼ˆé‡‘è‰²å¾€ä¸Šé£„ï¼‰
3. çŸ­æš«åœé “ 500ms
4. æ–°æ•µäººå¾å³é‚Šæ·¡å…¥

ç©å®¶æ­»äº¡ï¼š
1. ç•«é¢ç°éšæˆ–ç´…è‰²é–ƒçˆ
2. å½ˆå‡º DeathModal
```

### ç§»å‹•è¡¨ç¾
```
ä¸æ˜¯å‹•ç•«è§’è‰²åœ¨èµ°è·¯ã€‚
è€Œæ˜¯ï¼šä¸€å€‹é€²åº¦æ¢å¾ 0% åˆ° 100%ï¼Œ
åˆ° 100% æ™‚å‡ºç¾æ–°æ•µäººã€‚
```

---

## Git è¦ç¯„

### Commit è¨Šæ¯
```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¾© bug
refactor: é‡æ§‹
style: æ¨£å¼èª¿æ•´
docs: æ–‡ä»¶æ›´æ–°
```

### æ¯æ¬¡ commit å¾Œ
1. æ›´æ–° CHANGELOG.md
2. å¦‚æœæ˜¯æ–°åŠŸèƒ½ï¼Œæ›´æ–°æ­¤æ–‡ä»¶çš„ã€Œå·²å®Œæˆã€æ¸…å–®

---

## é€²åº¦è¿½è¹¤

### âœ… å·²å®Œæˆ
- [ ] å°ˆæ¡ˆåˆå§‹åŒ– (Expo + TypeScript)
- [ ] åŸºæœ¬ä½ˆå±€ (SafeArea + TopBar + BattleView + UpgradePanel)
- [ ] éŠæˆ²å¼•æ“ (GameEngine.ts + setInterval)
- [ ] æˆ°é¬¥ç³»çµ± (CombatSystem.ts)
- [ ] è¡€æ¢ + å‚·å®³é£„å­—
- [ ] å‡ç´šé¢æ¿
- [ ] å­˜æª”ç³»çµ± (AsyncStorage)
- [ ] é›¢ç·šçå‹µ

### ğŸ”² å¾…å®Œæˆ
- [ ] è£å‚™ç³»çµ±
- [ ] æŠ€èƒ½ç³»çµ±
- [ ] è½‰ç”Ÿç³»çµ±
- [ ] å¤šå€åŸŸ/Boss
- [ ] AdMob å»£å‘Š
- [ ] IAP å…§è³¼
- [ ] Google Play ä¸Šæ¶

---

## å¸¸ç”¨æŒ‡ä»¤

```bash
npx expo start            # é–‹ç™¼ï¼ˆæ‰‹æ©Ÿæƒ QR codeï¼‰
npx expo start --android  # Android æ¨¡æ“¬å™¨
eas build --platform android --profile preview  # å»ºç½® APK
eas submit --platform android                   # ä¸Šå‚³ Google Play
```

---

## æ³¨æ„äº‹é …

1. **æ‰€æœ‰å°ºå¯¸ç”¨ scale() å‡½æ•¸** - ä¸è¦å¯«æ­» px
2. **éŠæˆ²é‚è¼¯å’Œ UI åˆ†é›¢** - engine/ è³‡æ–™å¤¾ä¸ import React
3. **å­˜æª”é »ç‡** - æ¯ 30 ç§’ + æ¯æ¬¡é‡è¦æ“ä½œå¾Œ
4. **è¨˜æ†¶é«”** - åœ–ç‰‡ä¸è¶…é 512x512ï¼Œç”¨ PNG
5. **TypeScript** - æ‰€æœ‰æª”æ¡ˆç”¨ .ts/.tsxï¼Œä¸è¦ç”¨ .js
